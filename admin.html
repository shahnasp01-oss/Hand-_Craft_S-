<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f5f7fb;
    }
    header {
        background: black;
        padding: 15px;
        text-align: center;
        color: white;
        font-size: 22px;
        font-weight: bold;
    }
    .container {
        max-width: 650px;
        margin: auto;
        padding: 15px;
    }
    .card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #ddd;
        margin-bottom: 20px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }
    input, button {
        width: 100%;
        padding: 12px;
        margin: 8px 0;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 16px;
    }
    button {
        background: black;
        color: white;
        cursor: pointer;
        font-weight: bold;
    }
    .edit-btn {
        background: #ffa500;
        margin-top: 10px;
    }
    .delete-btn {
        background: #ff4444;
        margin-top: 10px;
    }
    .img-preview {
        height: 90px;
        border-radius: 6px;
        margin-top: 10px;
        object-fit: cover;
        border: 1px solid #ddd;
    }
</style>
</head>
<body>

<header>HandCraft Admin Panel</header>

<div class="container">

    <!-- ADD PRODUCT -->
    <div class="card">
        <h3>Add / Update Product</h3>

        <input id="name" placeholder="Product Name">
        <input id="price" placeholder="Price">

        <input type="file" id="fileInput">
        <img id="preview" class="img-preview" style="display:none;">

        <button id="addBtn">SAVE PRODUCT</button>
    </div>

    <!-- PRODUCT LIST -->
    <div class="card">
        <h3>Product List</h3>
        <div id="list"></div>
    </div>

</div>


<script>
// ---------------- FIREBASE SETUP ----------------
const firebaseConfig = {
  apiKey: "AIzaSyDp70r1FmP-n5jPvZFtHa_cxn9J6iK5vJs",
  authDomain: "handcraft-app-2e144.firebaseapp.com",
  projectId: "handcraft-app-2e144",
  storageBucket: "handcraft-app-2e144.firebasestorage.app",
  messagingSenderId: "391900602122",
  appId: "1:391900602122:web:48401b0de085608093a4f3",
  databaseURL: "https://handcraft-app-2e144-default-rtdb.asia-southeast1.firebasedatabase.app"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database().ref("products");
const storage = firebase.storage();

let editId = null;

// IMAGE PREVIEW
document.getElementById("fileInput").onchange = function(e){
    const file = e.target.files[0];
    if(file){
        document.getElementById("preview").src = URL.createObjectURL(file);
        document.getElementById("preview").style.display = "block";
    }
};

// ADD or UPDATE PRODUCT
document.getElementById("addBtn").onclick = async function () {
    const nameVal = name.value.trim();
    const priceVal = price.value.trim();
    const file = fileInput.files[0];

    if (!nameVal || !priceVal) {
        alert("Name & Price required!");
        return;
    }

    let imageUrl = "";

    // upload image if new
    if (file) {
        const storageRef = storage.ref("images/" + Date.now() + "_" + file.name);
        await storageRef.put(file);
        imageUrl = await storageRef.getDownloadURL();
    }

    if (editId) {
        // UPDATE
        const oldImg = document.getElementById(editId).dataset.oldImg;
        db.child(editId).update({
            name: nameVal,
            price: priceVal,
            image: imageUrl || oldImg
        });

        editId = null;
        addBtn.innerText = "SAVE PRODUCT";
    } else {
        // NEW PRODUCT
        db.push({
            name: nameVal,
            price: priceVal,
            image: imageUrl
        });
    }

    // reset
    name.value = "";
    price.value = "";
    fileInput.value = "";
    preview.style.display = "none";
};


// LOAD PRODUCTS
db.on("value", snap => {
    const listDiv = document.getElementById("list");
    listDiv.innerHTML = "";

    snap.forEach(child => {
        const item = child.val();

        listDiv.innerHTML += `
            <div id="${child.key}" class="card" style="margin-bottom:10px;">
                <img src="${item.image}" class="img-preview">
                <h4>${item.name}</h4>
                <p>â‚¹ ${item.price}</p>
                <button class="edit-btn" onclick="editItem('${child.key}', '${item.name}', '${item.price}', '${item.image}')">EDIT</button>
                <button class="delete-btn" onclick="deleteItem('${child.key}')">DELETE</button>
            </div>
        `;
    });
});

// EDIT PRODUCT
function editItem(id, nameVal, priceVal, imgVal){
    editId = id;
    document.getElementById("name").value = nameVal;
    document.getElementById("price").value = priceVal;
    document.getElementById("preview").src = imgVal;
    document.getElementById("preview").style.display = "block";
    document.getElementById(id).dataset.oldImg = imgVal;
    addBtn.innerText = "UPDATE PRODUCT";
}

// DELETE
function deleteItem(id){
    if(confirm("Delete this product?")){
        db.child(id).remove();
    }
}
</script>

</body>
</html>
